<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">

    <link rel="stylesheet" href="Assets/light7/dist/css/light7.min.css">

    <title>拼花大师™地板</title>

    <style>
        html {
            font-size: 20px !important;
        }
        .popup{
            background: #eee
        }
    </style>

</head>
<body>

    <!-- page 容器 -->
    <div class="page page-current" id="main">
        <!-- 这里是页面内容区 -->
        <div class="content">
            <div class="buttons-tab">
                <a href="#tab1" class="tab-link active button">单据流水</a>
                <a href="#tab2" class="tab-link button">客户列表</a>
            </div>

            <div class="tabs">
                <div id="tab1" class="tab active">
                    <div class="list-block media-list inset">
                        <ul id="单据流水"></ul>

                    </div>
                    
                </div>
                <div id="tab2" class="tab">
                    <div class="list-block inset">
                        <ul id="客户列表"></ul>
                    </div>
                </div>

            </div>

        </div>
    </div>

    <div class='popups_单据流水'>
        <div class='popup' id='单据明细'>
            <header class='bar bar-nav'>
                <h1 class='title'>单据明细</h1>
                <a href='#' class='button button-link button-nav pull-left close-popup'>
                    <span class='icon icon-left'></span> 关闭
                </a>
            </header>
            <div class='content'>
                <div class='list-block media-list inset'>
                    <ul>

                    </ul>
                </div>
            </div>
            </div>
    </div>

    <div class='popups_单位信息'>

    </div>
    <div class="popups_发货明细">
        <div class='popup' id='发货单'>
            <header class='bar bar-nav'>
                <h1 class='title'>单据列表</h1>
                <a href='#' class='button button-link button-nav pull-left close-popup'>
                    <span class='icon icon-left'></span> 关闭
                </a>
            </header>
            <nav class="bar bar-tab">
                <a class="tab-item" href="#" onclick="{ window.行号 -= window.每页行数; if (window.行号 < 0) window.行号 = 0; 获取发货清单(window.单位编号); }">
                    <span class="icon icon-left"></span>
                    <span class="tab-label">往前</span>
                </a>
                <a class="tab-item active" href="#" onclick="{ window.行号 = 0; 获取发货清单(window.单位编号); }">
                    <span class="icon icon-home"></span>
                    <span class="tab-label">首页</span>
                </a>
                <a class="tab-item" href="#" onclick="{ if (window.行号 < window.总行数 - window.每页行数) window.行号 += window.每页行数; 获取发货清单(window.单位编号); }">
                    <span class="icon icon-right"></span>
                    <span class="tab-label">往后</span>
                </a>
            </nav>
            <div class='content'>
                <div class='content-block-title'>拼花大师地板 KH-13-0032</div>
                <div class='card'>
                    <div class='card-header'>单号：SH-1603-005</div>
                    <div class='card-content'>
                        <div class='list-block media-list'>
                            <ul>
                                <li class='item-content item-link'>
                                    <div class='item-media'>
                                        <img src='/Assets/pic1.jpg' width='80'>
                                    </div>
                                    <div class='item-inner'>
                                        <div class='item-title-row'>
                                            <div class='item-title'>名称</div>
                                        </div>
                                        <div class='item-subtitle'>拼花大师地板</div>
                                        <div class='item-title-row'>
                                            <div class='item-title'>地址</div>
                                        </div>
                                        <div class='item-subtitle'>浙江省嘉善县开发区玉山路8号</div>

                                        <div class='item-title-row'>
                                            <div class='item-title'>统计</div>
                                        </div>
                                        <div class='item-title-row'>
                                            <div class='item-subtitle'>平方</div>
                                            <div class='item-subtitle color-primary'>2387.00</div>
                                        </div>
                                        <div class='item-title-row'>
                                            <div class='item-subtitle'>金额</div>
                                            <div class='item-subtitle color-primary'>238793.00</div>
                                        </div>

                                        <div class='item-title-row'><div class='item-title'>摘要</div></div>
                                        <div class='item-title-row'>
                                            <div class='item-subtitle'>榆木 拼花素板</div>
                                            <div class='item-subtitle'>1005片</div>
                                        </div>
                                        <div class='item-title-row'>
                                            <div class='item-subtitle'>柞木 拼花素板</div>
                                            <div class='item-subtitle'>870片</div>
                                        </div>
                                        <div class='item-title-row'>
                                            <div class='item-subtitle'>安然盛世 拼花</div>
                                            <div class='item-subtitle'>206片</div>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class='card-footer'>
                        <span>单据日期：2016-03-17</span>
                        <span>点击查看</span>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <div class="pages"></div>

    <script type='text/javascript' src='Scripts/jquery-2.2.1.min.js' charset='utf-8'></script>
    <script type='text/javascript' src='Assets/light7/dist/js/light7.min.js' charset='utf-8'></script>
    <script type='text/javascript' src='Assets/light7/dist/js/i18n/cn.min.js' charset='utf-8'></script>

    <script type="text/javascript">
        // 全局变量

        var 行号 = 0;
        var 总行数 = 0;
        var 单位编号 = "";
        var 每页行数 = 10;

        function 获取发货清单(id, name) {
            $("#发货单 .content").html("");
            $("#发货单 .title").text(name + "（" + id + "）");
            $.ajax({
                url: "发货.ashx?行为=发货明细&单位编号=" + id+"&行号="+window.行号,
                dataType: "json",
                success: function (data) {
                    
                    window.总行数 = data.总行数;
                    var s = "";
                    for (var i in data.单据信息) {
                        s += "<div class='content-block-title'>" + data.单据信息[i].rn + "＃" + "</div>"
                        s += "<div class='card'>"
                        s += "<div class='card-header'>"
                        s += "<span>单号：" + data.单据信息[i].送货单号 + "</span>"
                        //s += "<span>日期：" + data.单据信息[i].送货日期 + "</span>"
                        s += "</div>"
                        s += "<div class='card-content'>"
                        s += "<div class='list-block media-list'>"
                        s += "<ul>"
                        s += "<li class='item-content'>"
                        s += "<div class='item-media'>"
                        s += "<img src='/Assets/pic1.jpg' width='80'>"
                        s += "</div>"
                        s += "<div class='item-inner'>"
                        //s += "<div class='item-title-row'>"
                        //s += "<div class='item-title'>名称：</div>"
                        //s += "</div>"
                        //s += "<div class='item-subtitle'>" + data.单据信息[i].客户 + "</div>"

                        //s += "<div class='item-title-row'>"
                        //s += "<div class='item-title'>地址：</div>"
                        //s += "</div>"
                        //s += "<div class='item-subtitle'>"+data.单据信息[i].地址+"</div>"

                        s += "<div class='item-title-row'><div class='item-title'>摘要：</div></div>"
                        for (var j in data.发货明细) {
                            if (data.发货明细[j].ExcelServerRCID == data.单据信息[i].ExcelServerRCID) {
                                s += "<div class='item-title-row'>"
                                s += "<div class='item-subtitle'>" + data.发货明细[j].描述 + "</div>"
                                s += "<div class='item-subtitle'>" + data.发货明细[j].PCS + " P</div>"
                                s += "</div>"
                            }
                        }

                        s += "<div class='item-title-row'>"
                        s += "<div class='item-title'>统计：</div>"
                        s += "</div>"
                        s += "<div class='item-title-row'>"
                        s += "<div class='item-subtitle'>平方</div>"
                        s += "<div class='item-subtitle color-primary'>" + data.单据信息[i].square + "</div>"
                        s += "</div>"
                        s += "<div class='item-title-row'>"
                        s += "<div class='item-subtitle'>金额</div>"
                        s += "<div class='item-subtitle color-primary'>" + data.单据信息[i].total + "</div>"
                        s += "</div>"

                        s += "</div>"
                        s += "</li>"
                        s += "</ul>"
                        s += "</div>"
                        s += "</div>"
                        s += "<div class='card-footer'>"
                        s += "<span>单据日期：" + data.单据信息[i].送货日期 + "</span>"
                        s += "<a href='#' class='link'>查看详情</a>"
                        s += "</div>"
                        s += "</div>"
                    }
                    $("#发货单 .content").html(s);
                }
            })

        }

        var $Orders = new Object();
        $Orders.操作对象 = $("#单据流水");
        $Orders.每页行数 = 20;
        $Orders.开始行号 = 0;
        $Orders.绑定点击事件 = function()
        {
            $Orders.操作对象.find("li").click(function () {
                var s1 = "&rcid=" + this.id;
                
                $.ajax({
                    url: "发货.ashx?行为=单据流水_单据明细" + s1,
                    dataType: "json",
                    async: false,
                    success: function (data) {
                        var htmlstring = "";
                        for (var v in data) {
                            htmlstring += "<li>"
                            htmlstring += "<a href='#' class='item-link item-content'>"
                            htmlstring += "<div class='item-inner'>"
                            htmlstring += "<div class='item-title-row'>"
                            htmlstring += "<div class='item-title'>" + data[v].ExcelServerRN + "＃ " + data[v].描述 + "</div>"
                            htmlstring += "<div class='item-subtitle'>" + data[v].编号 + "</div>"
                            htmlstring += "</div>"
                            htmlstring += "<div class='item-subtitle'>数量：" + data[v].PCS + " 片（" + data[v].单位数量 + " " + data[v].计价单位 + "）</div>"
                            htmlstring += "<div class='item-subtitle'>单价：" + data[v].单价 + " 元/" + data[v].计价单位 + "</div>"
                            htmlstring += "<div class='item-subtitle'>金额：" + data[v].金额 + " 元</div>"
                            htmlstring += "<div class='item-title-row'>"
                            htmlstring += "<div class='item-subtitle'></div>"
                            htmlstring += "</div>"
                            htmlstring += "<div class='item-text'>木种：" + data[v].木种 + "，工艺：" + data[v].工艺 + "</div>"
                            htmlstring += "</div>"
                            htmlstring += "</a>"
                            htmlstring += "</li>"
                        }
                        $("#单据明细").find("ul").html(htmlstring);
                    }
                })
                $.popup("#单据明细")
            });
            return this;
        }
        $Orders.构造单据流水列表 = function (selector)
        {
            if (selector != null)
                this.操作对象 = $(selector);
            var s1 = "&每页行数=" + this.每页行数;
            var s2 = "&开始行号=" + this.开始行号;
            $.ajax({
                url: "发货.ashx?行为=单据流水" + s1 + s2,
                dataType: "json",
                async: false,
                success: function (data) {
                    var htmlstring = "";
                    for (var i in data) {
                        htmlstring += "<li class='item-content item-link' id='" + data[i].ExcelServerRCID + "'>";
                        htmlstring += "<div class='item-media'><i class='icon icon-f7'></i></div>";
                        htmlstring += "<div class='item-inner'>"
                        htmlstring += "<div class='item-title-row'>"
                        htmlstring += "<div class='item-title'>" + data[i].客户 + "</div>"
                        htmlstring += "<div class='item-subtitle'>" + data[i].业务描述 + "</div>"
                        htmlstring += "</div>"
                        htmlstring += "<div class='item-title-row'>"
                        htmlstring += "<div class='item-subtitle'>" + data[i].送货单号 + "</div>"
                        htmlstring += "<div class='item-subtitle'>" + data[i].送货日期 + "</div>"
                        htmlstring += "</div>"
                        htmlstring += "<div class='item-title-row'>"
                        htmlstring += "<div class='item-subtitle'>５ items</div>"
                        htmlstring += "<div class='item-subtitle'><span class='color-primary'>" + data[i].金额 + "</span></div>"
                        htmlstring += "</div>"
                        htmlstring += "</li>";
                    }
                    $Orders.操作对象.html(htmlstring);
                }
            });
            return this;
        }
        $Orders.构造单据流水列表().绑定点击事件();
        
    </script>
    <script type="text/javascript">

        function BuildActionsGroup(id, name) {
            var buttons1 = [{
                text: name + "（" + id + "）",
                label: true
            },
            {
                text: '单位信息',
                //bold: true,
                color: 'primary',
                onClick: function () {
                    $.popup(".popup-" + id)
                }
            },
            {
                text: '发货明细',
                //bold: true,
                color: 'warning',
                onClick: function () {
                    window.单位编号 = id;
                    window.行号 = 0;
                    获取发货清单(id,name);
                    $.popup("#发货单");
                }
            }
            ];
            var buttons2 = [{
                text: '取消',
                bg: 'danger'
            }
            ];
            var groups = [buttons1, buttons2];
            return groups;
        }
    </script>
    <script type='text/javascript'>
        $.showIndicator();
        $.ajax({
            url: "发货.ashx?行为=往来单位",
            dataType: "json",
            success: function (data) {
                var s = "";
                var s2 = "";
                for (var i in data) {
                    s += "<li class='item-content item-link' id='" + data[i].单位编号 + "'>";
                    s += "<div class='item-media'><i class='icon icon-f7'></i></div>";
                    s += "<div class='item-inner'>";
                    s += "<div class='item-title'>" + data[i].单位名称 + "</div>";
                    //s += "<div class='item-after'><span class='color-primary'>" + data[i].单位编号 + "</span></div>";
                    s += "</div>";
                    s += "</li>";
                }
                $("#客户列表").html(s).find("li").click(function () {
                    $.actions(BuildActionsGroup(this.id, $(this).find(".item-title").text()));
                });

                for (var i in data) {
                    s2 += "<div class='popup popup-" + data[i].单位编号 + "'>";
                    s2 += "<header class='bar bar-nav'>";
                    s2 += "<h1 class='title'>单位信息</h1>";
                    s2 += "<a href='#' class='button button-link button-nav pull-left close-popup'>";
                    s2 += "<span class='icon icon-left'></span> 关闭"
                    s2 += "</a>"
                    s2 += "</header>"
                    s2 += "<div class='content'>"
                    s2 += "<div class='list-block'>"
                    s2 += "<ul>"
                    s2 += "<li>"
                    s2 += "<div class='item-content'>"
                    s2 += "<div class='item-media'><i class='icon icon-form-email'></i></div>"
                    s2 += "<div class='item-inner'>"
                    s2 += "<div class='item-title label'>单位编号</div>"
                    s2 += "<div class='item-input'>"
                    s2 += "<input type='text' placeholder='未登记' value='" + data[i].单位编号 + "' readonly>"
                    s2 += "</div>"
                    s2 += "</div>"
                    s2 += "</div>"
                    s2 += "</li>"
                    s2 += "<li>"
                    s2 += "<div class='item-content'>"
                    s2 += "<div class='item-media'><i class='icon icon-form-name'></i></div>"
                    s2 += "<div class='item-inner'>"
                    s2 += "<div class='item-title label'>单位名称</div>"
                    s2 += "<div class='item-input'>"
                    s2 += "<input type='text' placeholder='未登记' value='" + data[i].单位名称 + "' readonly>"
                    s2 += "</div>"
                    s2 += "</div>"
                    s2 += "</div>"
                    s2 += "</li>"
                    s2 += "<li>"
                    s2 += "<div class='item-content'>"
                    s2 += "<div class='item-media'><i class='icon icon-form-password'></i></div>"
                    s2 += "<div class='item-inner'>"
                    s2 += "<div class='item-title label'>优先级</div>"
                    s2 += "<div class='item-input'>"
                    s2 += "<input type='text' placeholder='未登记' value='" + data[i].RANK + "' readonly>"
                    s2 += "</div>"
                    s2 += "</div>"
                    s2 += "</div>"
                    s2 += "</li>"
                    s2 += "<li>"
                    s2 += "<div class='item-content'>"
                    s2 += "<div class='item-media'><i class='icon icon-form-tel'></i></div>"
                    s2 += "<div class='item-inner'>"
                    s2 += "<div class='item-title label'>电话</div>"
                    s2 += "<div class='item-input'>"
                    s2 += "<input type='text' placeholder='未登记' value='" + data[i].电话 + "' readonly>"
                    s2 += "</div>"
                    s2 += "</div>"
                    s2 += "</div>"
                    s2 += "</li>"
                    s2 += "<li>"
                    s2 += "<div class='item-content'>"
                    s2 += "<div class='item-media'><i class='icon icon-form-url'></i></div>"
                    s2 += "<div class='item-inner'>"
                    s2 += "<div class='item-title label'>传真</div>"
                    s2 += "<div class='item-input'>"
                    s2 += "<input type='text' placeholder='未登记' value='" + data[i].传真 + "' readonly>"
                    s2 += "</div>"
                    s2 += "</div>"
                    s2 += "</div>"
                    s2 += "</li>"
                    s2 += "<li class='align-top'>"
                    s2 += "<div class='item-content'>"
                    s2 += "<div class='item-media'><i class='icon icon-form-comment'></i></div>"
                    s2 += "<div class='item-inner'>"
                    s2 += "<div class='item-title label'>地址</div>"
                    s2 += "<div class='item-input'>"
                    s2 += "<textarea readonly>" + data[i].单位地址 + "</textarea>"
                    s2 += "</div>"
                    s2 += "</div>"
                    s2 += "</div>"
                    s2 += "</li>"
                    s2 += "<li class='align-top'>"
                    s2 += "<div class='item-content'>"
                    s2 += "<div class='item-media'><i class='icon icon-form-comment'></i></div>"
                    s2 += "<div class='item-inner'>"
                    s2 += "<div class='item-title label'>备注</div>"
                    s2 += "<div class='item-input'>"
                    s2 += "<textarea readonly></textarea>"
                    s2 += "</div>"
                    s2 += "</div>"
                    s2 += "</div>"
                    s2 += "</li>"
                    s2 += "</ul>"
                    s2 += "</div>"
                    s2 += "</div>"
                    s2 += "</div>"
                }

                $(".popups_单位信息").html(s2);
            },
            error: function () {
                var s = "";
                s += "<li class='item-content item-link'>";
                s += "<div class='item-media'><i class='icon icon-f7'></i></div>";
                s += "<div class='item-inner'>";
                s += "<div class='item-title'>" + "加载失败" + "</div>";
                s += "</div>";
                s += "</li>";
                $("#客户列表").html(s);
            },
            complete: function () {
                $.hideIndicator();
            }
        })
    </script>



</body>

</html>
